# 三 关于“高级充电算法” ｜ bq4050从上电到PF
本来这一章是要写保护参数设置的，但是上一章有读者对“TC”、“FC”、“TD”、“FD”、“充电抑制”、“充电挂起”等概念感到疑惑，我查阅sluuaq3后发现，这里是我曾经忽略的一部分：高级充电算法。  
高级充电算法是一种根据电池当前RM或电压，以及温度来确定充电电流和电压的功能。这适用于可以与bq4050通过一定方式通信的智能充电器，以优化充电速度和电池寿命。  
bq4050中使用的高级充电算法如下图控制充电电流：  
![](https://bq4050startup.vercel.app/pages/assets/3-1.jpg)  
图中横轴为温度，有T1、T2、T5、T6、T3、T4六个分界线。纵轴为电池电压，有CVL、CVM、CVH三个分界线。这些分界线组合成了如图所示的15+1种充电状态，即：  
- 当电池温度低于T1时，电池充电状态为充电抑制或充电挂起。  
- 当电池温度介于T1与T2间时，电池充电状态如下分类讨论：  
    - 当电池电压低于CVL时，电池充电状态为预充电。  
    - 当电池电压高于CVL时，电池充电状态如图中3\*5的十五格所示。  
        - 十五格的温度标注：  
            - LT：低温状态，介于T1-T2。
            - STL：标准状态低温段，介于T2-T5。
            - RT：建议充电温度，介于T5-T6。这一段温度区域是理论上最适合电池充电的。
            - STH：标准状态高温段，介于T6-T3。STL+RT+STH共同构成电池的整个可正常充电温度区间。
            - HT：高温状态，介于T3-T4。
        - 十五格的电流标注：
            - CCL：低压充电电流。当电压介于CVL和CVM之间。
            - CCM：中压充电电流。当电压介于CVM和CVH之间。
            - CCH：高压充电电流。当电压高于CVH。
- 当电池温度高于T3但低于T4时，电池充电状态为充电抑制。
- 当电池温度高于T4时，电池充电状态为充电挂起。

看到图中左下角“Charge Inhibit”（充电抑制）与“Charge Suspend”（充电挂起”）范围是重叠的，有读者可能会疑惑，若温度低于T1，究竟会触发哪种状态？  
我查阅了TI E2E社区，找到了这个帖子：  
![](https://bq4050startup.vercel.app/pages/assets/3-2.jpg)  
由此可知，充电抑制是充电开始前进行检查，充电挂起是充电中进行检查。  
举个例子，如果充电中温度从T1-T2范围降到低于T1，则会触发充电挂起；若充电前温度就已经低于T1，则会触发充电抑制。如果充电中温度从STH进入HT范围，则不会停止充电；但如果充电前温度就已经处于HT范围，则会触发充电抑制。  
然后我们来细看。先说温度范围，sluuaq3中是这样图示的：  
![](https://bq4050startup.vercel.app/pages/assets/3-3.png)  
可以看见，基本上与上文所述一致，除了在从低温向RT和高温向RT的方向上加入了滞回。  
根据TI的要求，温度分界线的设置必须满足 **“T1 ≤ T2 ≤ T5 ≤ T6≤ T3≤ T4”** 的条件。  
然后是电压范围（RM替代电压作为控制依据的情况，本手册略过不写），如图：  
![](https://bq4050startup.vercel.app/pages/assets/3-4.png)  
由于本手册示例使用硬件并没有相应的智能充电器来调节充电电压，所以跳过。对应的DF中HV、MV、LV的单体充电电压设置为相同数值。  
下面我们来讲充电电流的决定策略。首先看TI在sluuaq3中给出的表：  
![](https://bq4050startup.vercel.app/pages/assets/3-5.png)  
![](https://bq4050startup.vercel.app/pages/assets/3-6.png)  
表中的决定顺序是从上到下依次判断，越靠上方的优先级越高。  
我们依次来解释一下图中的策略：  
- 无论温度与电压怎样，只要OperationStatus的XCHG位置1，充电电流就设为0。
- 如果温度低于T1或高于T4，那无论电压怎样，充电电流设为0。
- 无论温度怎样，如果电压低于CVL，充电电流设为预充电电流。
- 无论温度怎样，如果电压高于CVL，而且ChargingStatus的MCHG位置1，充电电流设为维护充电电流。
- （下面的就和开头那张图里面含义一样，我就不多说了吧）

充电电压的决定策略也是类似的。这里不再赘述，请参见sluuaq3。  
下面开始讲述一个前面提到的概念，“确认了充电终止”。  
确认了充电终止需要以下条件：  
![](https://bq4050startup.vercel.app/pages/assets/3-7.png)  
解释一下：  
- 如果GaugingStatus的DSG位置0（即没有在放电），那么高级充电算法就启动运行，这个状态被判定为充电中状态。
- 如果在连续的两个40s内，满足以下所有条件，状态就被判定为确认了充电终止：
    - 状态被判定为充电中
    - 平均电流小于设置的充电终止期电流阈值
    - 最高的单节电池电压加上设置的充电终止期电压阈值大于高级充电算法给出的充电电压与电池串数之比（这一条令我迷惑，但是可以自己试验下）
    - 累计充入电量小于0.25mAh

当被判定为确认了充电终止后，会：  
- 将ChargingStatus的VCT、MCHG位置1
- 如果SOCFlagConfig A的FCSETVCT位置1，则将BatteryStatus和GaugingStatus的FC位置1
- 如果SOCFlagConfig B的TCASETVCT位置1，则将BatteryStatus和GaugingStatus的TCA位置1

【本章节尚未完成，请您稍后再回来看看】
