# 零 序言 ｜ bq4050从上电到PF
鉴于锂电池使用愈发广泛，如何准确得知锂电池剩余电量成了一个技术问题。你当然不希望设备用着用着突然没电，你却无法预知。  
有人说，我测电压，4.2v满电，3.0v没电，简单易用。但是锂电池的充放电曲线并不是0-100%完美对应3.0-4.2v，具有非常大的非线性。  
此人又说了，那我打表，记住多少电压就是多少剩余电量，这样不就消除了非线性？恭喜您，您获得了第二代电量测量技术：OCV法（开路电压法）。但是你要注意一个问题：OCV法需要在电池开路静置状态下才能测得准确电量。而通常带载放电情况下，电池端电压往往低于开路电压，且停止放电后又需要一段或长或短的时间来恢复到开路电压。多数设备无法容忍为了测量剩余电量而停止放电并静置的时间开销。  
此人又说了，那我记住电池进去多少电，出来多少电，根据能量守恒，不就知道剩下多少电量了吗？恭喜您解锁第三代电量测量技术：库仑计法。这是自发明以来使用至今，且精度良好、成本合适的方案。只不过其仍然存在一个问题：多次充放电后，电池容量会由于误差的累积而越来越不准确。这是由于库仑计本质上是将电流对时间进行积分，所以电流的测量误差会被积分环节反复积累，最终影响系统的精度。  
那么我们需要给库仑计打个补丁，让库仑计测量电量相对变化，而让“补丁”在达到可以确信的电量时给库仑计一个绝对位置的校准。  
以德州仪器的产品为例，目前市场上流行的库仑电量计主要有两类补丁：
- 阻抗跟踪法：利用电池内阻随着剩余电量的变化而产生的改变确定几个电量与内阻的对应关系，从而在到达每一个内阻-电量对应点时重新校准库仑计的读数。
- CEDV法（补偿的放电末期电压法）：相较于放电中期较为平坦的放电曲线，放电末期的电压变化较明显，且与剩余电量具有良好相关性，这便是EDV法（放电末期电压法）。但是EDV法的EDV-电量关系会随着温度、放电负载等发生变化，不具有很高的应用价值。这时，可以根据电池在不同温度、电流的工作状态下的EDV-电量关系进行补偿计算，将补偿参数存入电量计，从而对EDV根据温度、负载情况进行补偿，得到CEDV数据，从而在到达特定的CEDV时提供确信的电量信息，重新校准库仑计的读数。  

根据德州仪器所提供的信息，一般来说阻抗跟踪法电量计的精度高于CEDV法电量计，但是阻抗跟踪法电量计需要一个称为ChemID的数据来确定电池的内阻-电量关系，这个数据存在于德州仪器所提供的bqStudio软件的数据库中。对于个人DIY用户来说，使用的电池多种多样，往往会出现自己使用的电池并不在德州仪器所提供的数据库当中的情况，而使用GPCCHEM工具（由德州仪器所提供，为特定电池的充放电数据匹配ChemID的在线工具，由于本手册不讨论阻抗跟踪法电量计的使用，故不展开讨论）也不一定能获得相近参数的ChemID，所以使用适应性更强的CEDV法电量计将会更适合这种情况。  
